name: "Build & Push"
description: "Build and push images"
inputs:
  TAG:
    description: "The tag for the workflow run"
    required: true

  IMAGE_REPOSITORY:
    description: "The tag for the workflow run"
    required: true
runs:
  using: "composite"
  steps:
    - name: Build and Push Bundle
      run: make bundle bundle-build bundle-push
      shell: bash
      env:
        GIT_TAG: ${{ inputs.TAG }}

    - name: Build and Push Catalog
      run: make catalog-render catalog-build catalog-push
      shell: bash
      env:
        GIT_TAG: ${{ inputs.TAG }}

    - name: Push Latest Tag
      if: ${{ steps.catalog_changed.outputs.catalog == 'true' }}
      uses: anothrNick/github-tag-action@1.71.0
      env:
        GITHUB_TOKEN: ${{ env.ADMIN_TOKEN }}
        WITH_V: true
        RELEASE_BRANCHES: ${{ inputs.RELEASE_BRANCH }}
        DEFAULT_BUMP: patch